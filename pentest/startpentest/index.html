<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="基础知识及环境搭建"><meta name="keywords" content=""><meta name="author" content="Neorah"><meta name="copyright" content="Neorah"><title>基础知识及环境搭建 | Neorah's Blog</title><link rel="shortcut icon" href="/img/melody-favicon32.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"DBINOT6FYU","apiKey":"c8bb9d887053d084aa4aee885c26cac5","indexName":"dev_Neorah","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础知识"><span class="toc-number">1.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#工作组"><span class="toc-number">1.1.</span> <span class="toc-text">工作组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#域"><span class="toc-number">1.2.</span> <span class="toc-text">域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#域控（DC）"><span class="toc-number">1.3.</span> <span class="toc-text">域控（DC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#活动目录"><span class="toc-number">1.4.</span> <span class="toc-text">活动目录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#域环境搭建"><span class="toc-number">2.</span> <span class="toc-text">域环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备工作"><span class="toc-number">2.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#搭建域控"><span class="toc-number">2.2.</span> <span class="toc-text">搭建域控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置ip"><span class="toc-number">2.2.1.</span> <span class="toc-text">设置ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更改计算机名"><span class="toc-number">2.2.2.</span> <span class="toc-text">更改计算机名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装域服务器和DNS服务"><span class="toc-number">2.2.3.</span> <span class="toc-text">安装域服务器和DNS服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#升级为域控"><span class="toc-number">2.2.4.</span> <span class="toc-text">升级为域控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Active-Directory用户"><span class="toc-number">2.2.5.</span> <span class="toc-text">创建Active Directory用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将win7加入域"><span class="toc-number">2.3.</span> <span class="toc-text">将win7加入域</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/neorah.jpg"></div><div class="author-info__name text-center">Neorah</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/Neorah" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">44</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">38</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">36</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Friends</div><a class="author-info-links__name text-center" href="http://blog.happysec.cn" target="_blank" rel="noopener">小北</a><a class="author-info-links__name text-center" href="https://ha1c9on.top/" target="_blank" rel="noopener">ha1c9on</a><a class="author-info-links__name text-center" href="http://www.const27.com" target="_blank" rel="noopener">const27</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/top.JPG)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Neorah's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Posts</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">基础知识及环境搭建</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-10-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%9F%9F%E6%B8%97%E9%80%8F/">域渗透</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">1.9k</span><span class="post-meta__separator">|</span><span>Reading time: 5 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="工作组"><a href="#工作组" class="headerlink" title="工作组"></a>工作组</h2><p>工作组（Work Group）是局域网中的一个概念。它是最常见最简单最普通的资源管理模式，就是将不同的电脑按功能分别列入不同的组中，以方便管理。在这个概念中，并不存在集中管理的节点，即无服务器和客户机的区分。</p>
<p>设置工作组？——右键我的电脑-&gt;属性-&gt;更改设置-&gt;更改：</p>
<h2 id="域"><a href="#域" class="headerlink" title="域"></a>域</h2><p>Windows域是计算机网络的一种形式，其中所有用户帐户 ，计算机，打印机和其他安全主体都在位于称为域控制器的一个或多个中央计算机集群上的中央数据库中注册。 身份验证在域控制器上进行。 在域中使用计算机的每个人都会收到一个唯一的用户帐户，然后可以为该帐户分配对该域内资源的访问权限。Windows域的概念与工作组的概念形成对比，在该工作组中，每台计算机都维护自己的安全主体数据库。</p>
<p>域(Domain)是Windows网络中独立运行的单位，域之间相互访问则需要建立信任关系(即Trust Relation)。信任关系是连接在域与域之间的桥梁。当一个域与其他域建立了信任关系后，2个域之间不但可以按需要相互进行管理，还可以跨网分配文件和打印机等设备资源，使不同的域之间实现网络资源的共享与管理，以及相互通信和数据传输。</p>
<p>域既是 Windows 网络操作系统的逻辑组织单元，也是Internet的逻辑组织单元，在 Windows 网络操作系统中，域是安全边界。域管理员只能管理域的内部，除非其他的域显式地赋予他管理权限，他才能够访问或者管理其他的域，每个域都有自己的安全策略，以及它与其他域的安全信任关系。</p>
<h2 id="域控（DC）"><a href="#域控（DC）" class="headerlink" title="域控（DC）"></a>域控（DC）</h2><p>域控制器（Domain Controller，简写为DC）是指在“域”模式下，至少有一台服务器负责每一台联入网络的电脑和用户的验证工作，相当于一个单位的门卫一样。域内的计算机若想互相访问，需要经过域控制器的审核。域控制器中存在由这个域的账户、密码、属于这个域的计算机等信息构成的数据库。当电脑联入网络时，域控制器首先要鉴别这台电脑是否是属于这个域的，用户使用的登录账号是否存在、密码是否正确。如果以上信息有一样不正确，那么域控制器就会拒绝这个用户从这台电脑登录。不能登录，用户就不能访问服务器上有权限保护的资源，他只能以对等网用户的方式访问Windows共享出来的资源，这样就在一定程度上保护了网络上的资源。</p>
<h2 id="活动目录"><a href="#活动目录" class="headerlink" title="活动目录"></a>活动目录</h2><p>活动目录（Active Directory，简称AD）是指域环境中提供目录服务的组件。AD存储了有关网络对象（比如用户、组、计算机、共享资源、打印机等）的信息，并且让管理员和用户能够轻松地查找和使用这些信息。AD使用了一种结构化的数据存储方式，并以此作为基础对目录信息进行合乎逻辑的分层组织。</p>
<p>域树/域林内的所有域共享一个活动目录，每个域只存储该域内的数据。</p>
<p>活动目录(Active Directory)主要提供以下功能：</p>
<ol>
<li>服务器及客户端计算机管理：管理服务器及客户端计算机账户，所有服务器及客户端计算机加入域管理并实施组策略。</li>
<li>用户服务：管理用户域账户、用户信息、企业通讯录（与电子邮件系统集成）、用户组管理、用户身份认证、用户授权管理等，按省实施组管理策略。</li>
<li>资源管理：管理打印机、文件共享服务等网络资源。</li>
<li>桌面配置：系统管理员可以集中的配置各种桌面配置策略，如：用户使用域中资源权限限制、界面功能的限制、应用程序执行特征限制、网络连接限制、安全配置限制等。</li>
<li>应用系统支撑：支持财务、人事、电子邮件、企业信息门户、办公自动化、补丁管理、防病毒系统等各种应用系统。</li>
</ol>
<h1 id="域环境搭建"><a href="#域环境搭建" class="headerlink" title="域环境搭建"></a>域环境搭建</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>我的电脑是mbp，用的虚拟机软件是Parallels Desktop。</p>
<p>用于建立小型迷你域环境的系统为：</p>
<p>Windows Server 2012R2：作为DC</p>
<p>Windows Server 2008R2、Win7：作为域成员加入域</p>
<p>在此之前先打开Parallels偏好设置：</p>
<p>为了更真实的模拟域环境，我设置的是host-only模式</p>
<img src="/pentest/startpentest/1.png" class="">

<p>取消勾选”启用IPv4 DHCP”和”启用IPv6 DHCP”。</p>
<p>要把“将Mac连接到此网络”取消勾选，不然Mac会占用掉其中的一个网段，我一开始就因为这个地方的问题没有查出来整了好一会。或者说不取消勾选，在设置域成员的ip时换成没有被占用的就可以了。</p>
<h2 id="搭建域控"><a href="#搭建域控" class="headerlink" title="搭建域控"></a>搭建域控</h2><h3 id="设置ip"><a href="#设置ip" class="headerlink" title="设置ip"></a>设置ip</h3><p>设置服务器ip为刚才偏好设置中的10.37.129.1，而且一般域控制器和DNS服务器都是装在一起的，因此DNS服务器地址也写本机就好：</p>
<img src="/pentest/startpentest/2.png" class="">

<h3 id="更改计算机名"><a href="#更改计算机名" class="headerlink" title="更改计算机名"></a>更改计算机名</h3><p>在“控制面板-&gt;系统和安全-&gt;系统”中点击“更改设置-&gt;更改”，然后把计算机名改为“DC”，点击确定后重启计算机生效。</p>
<h3 id="安装域服务器和DNS服务"><a href="#安装域服务器和DNS服务" class="headerlink" title="安装域服务器和DNS服务"></a>安装域服务器和DNS服务</h3><img src="/pentest/startpentest/3.png" class="">

<p>然后基本上就可以都选下一步了</p>
<p>在服务器角色处选择AD域服务和DNS服务器</p>
<img src="/pentest/startpentest/4.png" class="">

<p>然后再保持默认下一步。</p>
<h3 id="升级为域控"><a href="#升级为域控" class="headerlink" title="升级为域控"></a>升级为域控</h3><p>安装成功后会在提示需要将此服务器提升为域控制器，如果不慎点击了关闭，可以在右上角可以看到一个中间有“！”的三角形按钮。单击该按钮，提升服务器：</p>
<img src="/pentest/startpentest/5.png" class="">

<p>然后配置部署即可。</p>
<p>在先决条件检查处我也踩过一点坑，就是要求给管理员添加密码，但我添加后仍然无法通过先决条件检查。</p>
<p>针对这样的情况，可以打开cmd输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net user administrator &#x2F;passwordreq:yes</span><br></pre></td></tr></table></figure>

<p>即可。</p>
<p>安装完成重启计算机后，需要使用域管理员账户登录。此时在“服务器管理器”页面就可以看到 AD DS、DNS 服务了：</p>
<img src="/pentest/startpentest/6.png" class="">

<h3 id="创建Active-Directory用户"><a href="#创建Active-Directory用户" class="headerlink" title="创建Active Directory用户"></a>创建Active Directory用户</h3><p>由于要为win7和win server2008创建域控账户，需要先创建用户：</p>
<p>管理工具–&gt;Active Directory 用户和计算机</p>
<p>转到Users，新建用户，创建密码点击下一步即可。</p>
<h2 id="将win7加入域"><a href="#将win7加入域" class="headerlink" title="将win7加入域"></a>将win7加入域</h2><p>先设置win7ip为10.37.129.2，DNS地址设为10.37.129.1</p>
<img src="/pentest/startpentest/7.png" class="">

<p>打开cmd运行<code>ping neorah.me</code>试试：</p>
<img src="/pentest/startpentest/8.png" class="">

<p>然后再加入域：</p>
<p>控制面板–&gt;系统和安全–&gt;系统–&gt;更改设置</p>
<p>在系统属性中点击”更改”，将本机设置在域下，点击确定输入在上一步”创建Active Directory用户”中设置的用户名和密码即可。</p>
<img src="/pentest/startpentest/9.png" class="">

<p>然后，我们在DC中“Active Directory 用户和计算机”页面的Computers项可以看到Win7加入的计算机名：</p>
<img src="/pentest/startpentest/10.png" class="">

<p>当我们右键该项选择“所有任务-&gt;管理”时，会报如下错误，这是防火墙拦截的原因：</p>
<img src="/pentest/startpentest/11.png" class="">

<p>关闭即可。</p>
<img src="/pentest/startpentest/12.png" class="">

<p>然后就可以成功管理了。</p>
<img src="/pentest/startpentest/13.png" class="">

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Neorah</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://neorah.me/pentest/startpentest/">https://neorah.me/pentest/startpentest/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="noopener">CC BY-NC-SA 3.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/ctf/n1ctf2020/"><i class="fa fa-chevron-left">  </i><span>n1ctf2020 SignIn</span></a></div><div class="next-post pull-right"><a href="/ctf/%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/"><span>[天翼杯2020]apiTest wp</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/top.JPG)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By Neorah</div><div class="footer_custom_text">Theme By melody</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>